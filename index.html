<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>

    <title>Coworking Tycoon. Techspace: The Game. A coworking world-domination simulator.</title>

    <link
      rel='stylesheet'
      href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css'
      integrity='sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M'
      crossorigin='anonymous'
    >
    <link href='./css/app.css' rel='stylesheet' type='text/css'>
    <script src='./js/lib/logger.js'></script>
    <script src='./js/lib/util.js'></script>
    <script src='./js/lib/charts/gauge.js'></script>
    <script src='./js/lib/charts/line-chart.js'></script>
    <script src='./js/stores/progression_store.js'></script>
    <script src='./js/models/bank_account.js'></script>
    <script src='./js/models/lead.js'></script>
    <script src='./js/models/lease.js'></script>
    <script src='./js/models/lease_deal.js'></script>
    <script src='./js/models/management_information_system.js'></script>
    <script src='./js/models/member_company.js'></script>
    <script src='./js/models/project.js'></script>
    <script src='./js/models/space.js'></script>
    <script src='./js/decorators/bank_account_decorator.js'></script>
    <script src='./js/decorators/lease_decorator.js'></script>
    <script src='./js/decorators/management_information_system_decorator.js'></script>
    <script src='./js/decorators/project_decorator.js'></script>
    <script src='./js/services/daily_churn.js'></script>
    <script src='./js/services/interface_repainter.js'></script>
    <script src='./js/services/lead_generator.js'></script>
    <script src='./js/services/lease_purchaser.js'></script>
    <script src='./js/services/monthly_bill_payer.js'></script>
    <script src='./js/services/monthly_licence_fee_collector.js'></script>
    <script src='./js/services/project_runner.js'></script>
    <script src='./js/services/quarterly_rent_payer.js'></script>
    <script src='./js/services/sales_generator.js'></script>
    <script src='./js/stores/app_store.js'></script>
    <script src='./js/stores/project_store.js'></script>
    <script src='./js/stores/real_estate_market_store.js'></script>
    <script src='./js/app.js'></script>
  </head>
  <body>
    <div id='console'></div>

    <div class='container-fluid'>
      <div class='row pt-3 pb-2'>
        <div class='col'>
          <h3><strong><span id='member-count'></span> Members</strong></h3>
        </div>

        <div class='col'>
          <span id='date' class='float-right'></span>
        </div>
      </div>

      <div class='row'>
        <div class='col'>
          <div class='card mb-3'>
            <div class='card-body'>
              <h4 class='card-title'>Real Estate Market</h4>

              <div id='deals'></div>
            </div>
          </div>
        </div>
        <div class='col'>
          <div class='card mb-3'>
            <div class='card-body'>
              <h4 class='card-title'>Finance</h4>

              <div class="finance-chart-container">
                <canvas id="finance-chart" width="280" height="180"></canvas>
              </div>

              <div class="finance-grid">
                <div class="finance-item">
                  <strong>Balance:</strong>
                  <span id='balance'></span>
                </div>
                <div class="finance-item cash-low-container">
                  <div>
                    <strong>Cash Low:</strong>
                    <span id='forecast-cash-low'></span>
                  </div>
                  <div class="cash-forecast-meter">
                    <div id="cash-low-meter" class="cash-forecast-meter-fill"></div>
                  </div>
                </div>
                <div class="finance-item">
                  <strong>Revenue:</strong>
                  <span id='monthly-revenue'></span>
                </div>
                <div class="finance-item">
                  <strong>Overheads:</strong>
                  <span id='monthly-overheads'></span>
                </div>
                <div class="finance-item">
                  <strong>Rent:</strong>
                  <span id='quarterly-rent-bill'></span>
                </div>
                <div class="finance-item">
                  <strong>Margin:</strong>
                  <span id='gross-margin'></span>
                </div>
              </div>
            </div>
          </div>

          <div class='card mb-3 feature-section' data-feature="product">
            <div class='card-body'>
              <h4 class='card-title'>Product</h4>

              <div class="product-controls">
                <div class="level-group">
                  <div class="product-control-item">
                    <div class="control-label"><strong>Price:</strong></div>
                    <div class="control-buttons">
                      <button id='decrease-workstation-price'>-</button>
                      <button id='increase-workstation-price'>+</button>
                      <span id='workstation-price'></span>
                    </div>
                  </div>
                </div>
                
                <div class="level-group">
                  <div class="product-control-item">
                    <div class="control-label"><strong>Density:</strong></div>
                    <div class="control-buttons">
                      <button id='decrease-density'>-</button>
                      <button id='increase-density'>+</button>
                      <span id='density'></span>
                    </div>
                  </div>
                </div>
                
                <div class="level-group" id="community-events-outer-container">
                  <div id="community-events-container" class="feature-section" data-feature="communityEvents" style="display: none;">
                    <div class="product-control-item">
                      <div class="control-label"><strong>Events Budget:</strong></div>
                      <div class="control-buttons">
                        <button id="decrease-events-budget">-</button>
                        <button id="increase-events-budget">+</button>
                        <span id="events-budget"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class='card mb-3 feature-section' data-feature="development">
            <div class='card-body'>
              <h4 class='card-title'>Development</h4>
              
              <div class="level-group">
                <div class="info-grid">
                  <div class="info-item">
                    <strong>Spaces:</strong>
                    <span id='space-count'></span>
                  </div>
                  <div class="info-item">
                    <strong>Area:</strong>
                    <span id='space-total-area'></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class='col'>
          <div class='card mb-3'>
            <div class='card-body'>
              <h4 class='card-title'>
                Sales & Marketing
              </h4>

              <div class="gauge-row feature-section" data-feature="occupancyGauge">
                <div class="gauge-container">
                  <canvas id="occupancy-gauge" width="120" height="100"></canvas>
                  <span id='occupancy' style="display: none;"></span>
                </div>

                <div class="gauge-container feature-section" data-feature="churnGauge">
                  <canvas id="churn-gauge" width="120" height="100"></canvas>
                  <span id='monthly-churn-rate' style="display: none;"></span>
                </div>
              </div>
              
              <div class="member-satisfaction" id="member-satisfaction-panel" style="display: none;">
                <h5 class="section-subtitle">Member Satisfaction</h5>
                <div class="gauge-row">
                  <div class="gauge-container">
                    <canvas id="nps-gauge" width="120" height="100"></canvas>
                  </div>
                </div>
                
                <div class="nps-feedback-container">
                  <div class="nps-label">Top Feedback:</div>
                  <div id="nps-feedback" class="gauge-feedback"></div>
                </div>
              </div>

              <!-- Sales controls with an outer container that won't be affected by feature visibility -->
              <div id="sales-outer-container">
                <div id="sales-controls-container" class="level-group feature-section" data-feature="salesControls" style="display: none;">
                  <div class="level-controls">
                    <div class="level-label">
                      <strong>Sales:</strong> Level <span id='sales-level'></span>
                    </div>
                    <div class="level-button">
                      <button id='sales-level-up-button'>Level up</button>
                    </div>
                    <div class="level-cost">
                      <span id='sales-level-up-cost'></span>
                    </div>
                  </div>
                  <div class="level-info">
                    Volume: <span id='monthly-sales-volume'></span>
                  </div>
                </div>
              </div>
              
              <!-- Marketing controls with an outer container that won't be affected by feature visibility -->
              <div id="marketing-outer-container">
                <div id="marketing-controls-container" class="level-group feature-section" data-feature="marketingControls" style="display: none;">
                  <div class="level-controls">
                    <div class="level-label">
                      <strong>Marketing:</strong> Level <span id='marketing-level'></span>
                    </div>
                    <div class="level-button">
                      <button id='marketing-level-up-button'>Level up</button>
                    </div>
                    <div class="level-cost">
                      <span id='marketing-level-up-cost'></span>
                    </div>
                  </div>
                  <div class="level-info">
                    Leads: <span id='monthly-lead-volume'></span>
                  </div>
                </div>
              </div>
              
              <!-- Directly handle feature visibility for Sales and Marketing controls -->
              <script>
                // Create global variables to track project completions
                window.SALES_MANAGER_HIRED = false;
                window.MARKETING_MANAGER_HIRED = false;
                window.COMMUNITY_EVENTS_RUNNING = false;
                
                // Function to show Community Events Budget permanently
                window.showCommunityEvents = function() {
                  if (window.COMMUNITY_EVENTS_RUNNING) return; // Already handled
                  
                  window.COMMUNITY_EVENTS_RUNNING = true;
                  console.log("PERMANENT: Showing Community Events Budget");
                  
                  // Directly manipulate the main container
                  var eventsContainer = document.getElementById('community-events-container');
                  var eventsOuterContainer = document.getElementById('community-events-outer-container');
                  
                  if (eventsContainer) {
                    // Remove the feature-section class to bypass the feature visibility system
                    eventsContainer.classList.remove('feature-section'); 
                    eventsContainer.removeAttribute('data-feature');
                    
                    // Force display
                    eventsContainer.style.cssText = "display: block !important";
                    
                    // Make sure the outer container is visible too
                    if (eventsOuterContainer) {
                      eventsOuterContainer.style.cssText = "display: block !important";
                    }
                    
                    console.log("Community Events Budget now permanently visible");
                  }
                  
                  // Also set the ProgressionStore flag for belt and suspenders
                  if (typeof ProgressionStore !== 'undefined' && ProgressionStore.features) {
                    ProgressionStore.features.communityEvents.visible = true;
                  }
                  
                  // Force UI refresh
                  if (typeof needsUiUpdate !== 'undefined') {
                    needsUiUpdate = true;
                  }
                }
                
                // Function to show Sales controls permanently
                window.showSalesControls = function() {
                  if (window.SALES_MANAGER_HIRED) return; // Already handled
                  
                  window.SALES_MANAGER_HIRED = true;
                  console.log("PERMANENT: Showing Sales controls");
                  
                  // Directly manipulate the main container
                  var salesContainer = document.getElementById('sales-controls-container');
                  var salesOuterContainer = document.getElementById('sales-outer-container');
                  
                  if (salesContainer) {
                    // Remove the feature-section class to bypass the feature visibility system
                    salesContainer.classList.remove('feature-section'); 
                    salesContainer.removeAttribute('data-feature');
                    
                    // Force display
                    salesContainer.style.cssText = "display: block !important";
                    
                    // Make sure the outer container is visible too
                    if (salesOuterContainer) {
                      salesOuterContainer.style.cssText = "display: block !important";
                    }
                    
                    console.log("Sales controls now permanently visible");
                  }
                  
                  // Also set the ProgressionStore flag for belt and suspenders
                  if (typeof ProgressionStore !== 'undefined' && ProgressionStore.features) {
                    ProgressionStore.features.salesControls.visible = true;
                  }
                  
                  // Force UI refresh
                  if (typeof needsUiUpdate !== 'undefined') {
                    needsUiUpdate = true;
                  }
                }
                
                // Function to show Marketing controls permanently
                window.showMarketingControls = function() {
                  if (window.MARKETING_MANAGER_HIRED) return; // Already handled
                  
                  window.MARKETING_MANAGER_HIRED = true;
                  console.log("PERMANENT: Showing Marketing controls");
                  
                  // Directly manipulate the main container
                  var marketingContainer = document.getElementById('marketing-controls-container');
                  var marketingOuterContainer = document.getElementById('marketing-outer-container');
                  
                  if (marketingContainer) {
                    // Remove the feature-section class to bypass the feature visibility system
                    marketingContainer.classList.remove('feature-section');
                    marketingContainer.removeAttribute('data-feature');
                    
                    // Force display
                    marketingContainer.style.cssText = "display: block !important";
                    
                    // Make sure the outer container is visible too
                    if (marketingOuterContainer) {
                      marketingOuterContainer.style.cssText = "display: block !important";
                    }
                    
                    console.log("Marketing controls now permanently visible");
                  }
                  
                  // Also set the ProgressionStore flag for belt and suspenders
                  if (typeof ProgressionStore !== 'undefined' && ProgressionStore.features) {
                    ProgressionStore.features.marketingControls.visible = true;
                  }
                  
                  // Force UI refresh
                  if (typeof needsUiUpdate !== 'undefined') {
                    needsUiUpdate = true;
                  }
                }
                
                // Check project completion status frequently
                var projectCheckInterval = setInterval(function() {
                  try {
                    if (typeof ProjectStore !== 'undefined' && ProjectStore.isProjectCompleted) {
                      // Check Sales Manager project
                      if (ProjectStore.isProjectCompleted("Hire Sales Manager")) {
                        window.showSalesControls();
                      }
                      
                      // Check Marketing Manager project
                      if (ProjectStore.isProjectCompleted("Hire Marketing Manager")) {
                        window.showMarketingControls();
                      }
                      
                      // Check Community Events project
                      if (ProjectStore.isProjectCompleted("Run Community Events")) {
                        window.showCommunityEvents();
                      }
                      
                      // Continue checking every interval, even after projects complete
                      // This ensures controls remain visible and handles any repainting issues
                    }
                  } catch (err) {
                    console.error("Error in project check interval:", err);
                  }
                }, 500); // Check every 500ms
              </script>
            </div>
          </div>
        </div>

        <div class='col'>
          <div class='card mb-3'>
            <div class='card-body'>
              <h4 class='card-title'>Projects</h4>

              <div id='projects'></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class='bd-footer text-muted'>
        <div class='container-fluid p-3 p-md-5'>
          <p>
            Copyright &copy;
            <a
              href='https://www.techspace.co'
              target='_blank'
            >Techspace Group Ltd</a>.
            Code licensed
            <a
              rel='license noopener'
              href='https://github.com/techspaceco/coworking-tycoon/blob/master/README.md'
              target='_blank'
            >MIT</a>.
          </p>
        </div>
      </footer>
  </body>
</html>
